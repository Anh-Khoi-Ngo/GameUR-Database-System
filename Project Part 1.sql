set echo on

DROP TABLE MEMBERSHIP CASCADE CONSTRAINTS;
DROP TABLE RENTAL CASCADE CONSTRAINTS;
DROP TABLE PRICE CASCADE CONSTRAINTS;
DROP TABLE GAME CASCADE CONSTRAINTS;
DROP TABLE GAMECOPY CASCADE CONSTRAINTS;
DROP TABLE DETAILRENTAL CASCADE CONSTRAINTS;

--1
CREATE TABLE MEMBERSHIP
(
    MEM_NUM CHAR(4) NOT NULL,
    FNAME VARCHAR2(30) NOT NULL,
    LNAME VARCHAR2(30) NOT NULL,
    STREET VARCHAR2(120),
    CITY VARCHAR2(50),
    PROV CHAR(2),
    POSTAL CHAR(7),
    BALANCE NUMBER(10,2) CHECK (BALANCE >= 0),
    CONSTRAINT pk_MEMBERSHIP PRIMARY KEY (MEM_NUM)
);

CREATE TABLE RENTAL
(
    RENT_NUM CHAR(5) NOT NULL,
    RENT_DATE DATE NOT NULL,
    MEM_NUM CHAR(4) NOT NULL,
    CONSTRAINT pk_RENTAL PRIMARY KEY (RENT_NUM)
);
ALTER TABLE RENTAL
ADD CONSTRAINT fk_mem_ren
FOREIGN KEY (MEM_NUM)
REFERENCES MEMBERSHIP (MEM_NUM);

CREATE TABLE PRICE (
    PRICE_CODE CHAR(2) NOT NULL,
    DESCRIPTION VARCHAR2(20) NOT NULL,
    RENT_FEE NUMBER(5, 2) NOT NULL CHECK (RENT_FEE >= 0),
    DAILY_LATE_FEE NUMBER(5, 2) NOT NULL CHECK (DAILY_LATE_FEE > = 0),
    CONSTRAINT pk_PRICE PRIMARY KEY (PRICE_CODE)
);

CREATE TABLE GAME (
    GA_NUM CHAR(5) NOT NULL,
    TITLE VARCHAR2(75) NOT NULL,
    YEAR CHAR(4) NOT NULL CHECK (YEAR >= 1970),
    COST NUMBER(5, 2),
    GENRE VARCHAR2(50),
    PRICE_CODE CHAR(2) NOT NULL,
    CONSTRAINT pk_GAME PRIMARY KEY (GA_NUM)
);
ALTER TABLE GAME
ADD CONSTRAINT fk_gam_pri
FOREIGN KEY (PRICE_CODE)
REFERENCES PRICE (PRICE_CODE);

CREATE TABLE GAMECOPY (
    GC_NUM CHAR(6) NOT NULL,
    INDATE DATE NOT NULL,
    GA_NUM CHAR(5) NOT NULL,
    CONSTRAINT pk_GAMECOPY PRIMARY KEY (GC_NUM)
);
ALTER TABLE GAMECOPY
ADD CONSTRAINT fk_gam_det
FOREIGN KEY (GA_NUM)
REFERENCES GAME (GA_NUM);

CREATE TABLE DETAILRENTAL (
    RENT_NUM CHAR(5) NOT NULL,
    GC_NUM CHAR(6) NOT NULL,
    FEE NUMBER(5, 2) NOT NULL,
    DUE_DATE DATE NOT NULL,
    RETURN_DATE DATE,
    DAILY_LATE_FEE NUMBER(5, 2) NOT NULL,
    CONSTRAINT pk_DETAILRENTAL PRIMARY KEY (RENT_NUM, GC_NUM)
);
ALTER TABLE DETAILRENTAL
ADD CONSTRAINT fk_det_ren
FOREIGN KEY (RENT_NUM)
REFERENCES RENTAL (RENT_NUM);

ALTER TABLE DETAILRENTAL
ADD CONSTRAINT fk_det_gam
FOREIGN KEY (GC_NUM)
REFERENCES GAMECOPY (GC_NUM);

--2
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('102', 'TAMI', 'DAWSON', '2632 TAKLI CIRCLE', 'FREDERICTON', 'NB', 'E4C 1X2', 11);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('103', 'CURT', 'KNIGHT', '4025 CORNEL COURT', 'HALIFAX', 'NS', 'E2T 1T2', 6);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('104', 'JAMAL', 'MELENDEZ', '788 EAST 145TH AVENUE', 'MONCTON', 'NB', 'E4T 1U2', 0);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('105', 'IVA', 'MCCLAIN', '6045 MUSKET BALL CIRCLE', 'SUMMIT', 'NS', 'E4C 1J2', 15);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('106', 'MIRANDA', 'PARKS', '4469 MAXWELL PLACE', 'GERMANTOWN', 'NB', 'E2H 1S2', 0);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('107', 'ROSARIO', 'ELLIOTT', '7578 DANNER AVENUE', 'TRACEY', 'NB', 'E4C 1G2', 5);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('108', 'MATTIE', 'GUY', '4390 EVERGREEN STREET', 'LILY', 'NS', 'E7C 1F2', 0);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('109', 'CLINT', 'OCHOA', '1711 ELM STREET', 'GREENEVILLE', 'NB', 'E2K 1H2', 10);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('110', 'LEWIS', 'ROSALES', '4524 SOUTHWIND CIRCLE', 'SUSSEX', 'NB', 'E7H 1X8', 0);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('111', 'STACY', 'MANN', '2789 EAST COOK AVENUE', 'DIEPPE', 'NB', 'E4C 1C2', 8);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('112', 'LUIS', 'TRUJILLO', '7267 MELVIN AVENUE', 'ST. ANDREWS', 'NB', 'E4A 1X2', 3);
INSERT INTO MEMBERSHIP (MEM_NUM, FNAME, LNAME, STREET, CITY, PROV, POSTAL, BALANCE) 
VALUES ('113', 'MINNIE', 'GONZALES', '6430 VASILI DRIVE', 'SAINT JOHN', 'NB', 'E3P 1X5', 0);

SELECT * FROM MEMBERSHIP;

INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1001', DATE'2017-03-01', '103');
INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1002', DATE'2016-12-12', '105');
INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1003', DATE'2016-11-13', '102');
INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1004', DATE'2017-03-10', '110');
INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1005', DATE'2017-02-04', '111');
INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1006', DATE'2017-02-25', '107');
INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1007', DATE'2016-12-12', '104');
INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1008', DATE'2017-01-01', '105');
INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM)
VALUES ('1009', DATE'2016-10-12', '111');

SELECT * FROM RENTAL;

INSERT INTO PRICE (PRICE_CODE, DESCRIPTION, RENT_FEE, DAILY_LATE_FEE) 
VALUES ('1', 'Standard', 2, 1.5);
INSERT INTO PRICE (PRICE_CODE, DESCRIPTION, RENT_FEE, DAILY_LATE_FEE) 
VALUES ('2', 'New Release', 3.5, 3);
INSERT INTO PRICE (PRICE_CODE, DESCRIPTION, RENT_FEE, DAILY_LATE_FEE) 
VALUES ('3', 'Discount', 1.5, 1);
INSERT INTO PRICE (PRICE_CODE, DESCRIPTION, RENT_FEE, DAILY_LATE_FEE) 
VALUES ('4', 'Weekly Special', 1, 0.5);

SELECT * FROM PRICE;

INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1234', 'BATTLEFIELD 1', '2016', 79.99, 'ACTION', '1');
INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1235', 'MASS Effect Andromeda', '2017', 89.99, 'ACTION', '2');
INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1236', 'EverQuest', '1999', 59.95, 'RPG', '3');
INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1237', 'Fable II', '2010', 49.95, 'RPG', '3');
INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1238', 'Mario Kart 8 Deluxe', '2017', 89.95, 'RACING', '2');
INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1239', 'Blur', '2010', 29.49, 'RACING', '1');
INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1245', 'Grand Theft Auto V', '2012', 45.49, 'ACTION', '1');
INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1246', 'Halo 4', '2012', 58.29, 'ACTION', '1');
INSERT INTO GAME (GA_NUM, TITLE, YEAR, COST, GENRE, PRICE_CODE) 
VALUES ('1247', 'Wipeout 3', '2012', 58.29, 'SIMULATION', '1');

SELECT * FROM GAME;

INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('34341', DATE'2017-01-22', '1235');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('34342', DATE'2017-01-22', '1235');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('34366', DATE'1999-03-02', '1236');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('34367', DATE'1999-03-02', '1236');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('34368', DATE'1999-03-02', '1236');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('34369', DATE'1999-03-02', '1236');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('44392', DATE'2010-10-21', '1237');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('44397', DATE'2010-10-21', '1237');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('54321', DATE'2016-06-18', '1234');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('54324', DATE'2016-06-18', '1234');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('54325', DATE'2016-06-18', '1234');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('59237', DATE'2010-02-14', '1237');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('61353', DATE'2013-01-28', '1245');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('61354', DATE'2013-01-28', '1245');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('61367', DATE'2012-07-30', '1246');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('61369', DATE'2012-07-30', '1246');
INSERT INTO GAMECOPY (GC_NUM, INDATE, GA_NUM) 
VALUES ('61388', DATE'2010-01-25', '1239');

SELECT * FROM GAMECOPY;

INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1001', '34342', 3.5, DATE'2017-03-04', DATE'2017-03-02', 3);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1001', '34366', 1.5, DATE'2017-03-04', DATE'2017-03-03', 1);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1001', '61353', 2, DATE'2017-03-04', DATE'2017-03-02', 1.5);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1002', '59237', 1.5, DATE'2016-12-15', DATE'2016-12-15', 1);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1003', '54325', 2, DATE'2016-11-16', DATE'2016-11-21', 1.5);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1003', '61369', 2, DATE'2016-11-16', DATE'2016-11-18', 1.5);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1003', '61388', 2, DATE'2016-11-16', DATE'2016-11-18', 1.5);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1004', '34341', 3.5, DATE'2017-03-13', DATE'2017-03-13', 3);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1004', '34367', 1.5, DATE'2017-03-13', DATE'2017-03-14', 1);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1004', '44392', 1.5, DATE'2017-03-13', DATE'2017-03-12', 1);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1005', '34342', 3.5, DATE'2017-02-07', DATE'2017-02-07', 3);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE)
VALUES ('1005', '44397', 1.5, DATE'2017-02-07', DATE'2017-02-06', 1);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1006', '34366', 1.5, DATE'2017-02-28', DATE'2017-02-28', 1);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1006', '61367', 2, DATE'2017-02-28', NULL, 1.5);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1007', '34368', 1.5, DATE'2016-12-15', NULL, 1);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1008', '34369', 1.5, DATE'2017-01-04', DATE'2017-01-04', 1);
INSERT INTO DETAILRENTAL (RENT_NUM, GC_NUM, FEE, DUE_DATE, RETURN_DATE, DAILY_LATE_FEE) 
VALUES ('1009', '54324', 2, DATE'2016-10-15', NULL, 1.5);

SELECT * FROM DETAILRENTAL;

--3
COMMIT;

--4
UPDATE GAME
SET YEAR = 2013
WHERE GA_NUM = 1245;

--5
UPDATE GAME
SET PRICE_CODE = 4
WHERE GENRE = 'SIMULATION';

--6
UPDATE PRICE
SET RENT_FEE = RENT_FEE + 0.50;

--7
COMMIT;

--8
SELECT GENRE, TITLE, YEAR, COST
FROM GAME
ORDER BY GENRE ASC, YEAR DESC;

--9
SELECT MEM_NUM AS "Member #", LNAME || ', ' || FNAME AS "Member Name", TO_CHAR(BALANCE, 'L999G999D99') AS "BALANCE"
FROM MEMBERSHIP;

--10
ALTER TABLE MEMBERSHIP
ADD Status CHAR(8) CHECK (Status IN ('ACTIVE', 'SUSPEND', 'CLOSED'));

SELECT MEM_NUM AS "Member #", LNAME || ', ' || FNAME AS "Member Name", TO_CHAR(BALANCE, 'L999G999D99') AS "BALANCE", Status
FROM MEMBERSHIP;

--11
UPDATE MEMBERSHIP
SET Status = 'ACTIVE'
WHERE MEM_NUM IN (
    SELECT DISTINCT MEM_NUM
    FROM RENTAL
);

SELECT MEM_NUM AS "Member #", LNAME || ', ' || FNAME AS "Member Name", TO_CHAR(BALANCE, 'L999G999D99') AS "BALANCE", Status
FROM MEMBERSHIP;

--12
SELECT GENRE, TITLE, YEAR, COST 
FROM GAME 
WHERE LOWER(TITLE) LIKE '%ef%' 
ORDER BY GENRE ASC, YEAR DESC;

--13
SELECT GENRE, TITLE, YEAR, COST
FROM GAME
WHERE (GENRE = 'RPG' OR GENRE = 'RACING') AND COST < 60
ORDER BY GENRE ASC, TITLE ASC;

--14
SELECT GENRE, COUNT(*) AS "# IN STOCK"
FROM GAME
GROUP BY GENRE;

--15
SELECT TO_CHAR(ROUND(AVG(COST), 2), 'L999G999D99') AS "AVG. GAM"
FROM GAME;                                              

--16
SELECT GENRE, AVG(COST) AS "AVG. GAME COST"
FROM GAME
GROUP BY GENRE
ORDER BY GENRE ASC;

--17
SELECT G.TITLE AS "Game Title", G.GENRE AS "Genre", P.DESCRIPTION AS "Pricing Description", TO_CHAR(P.RENT_FEE, 'L999G999D99') 
AS "Rental Fee", TO_CHAR(G.COST, 'L999G999D99') AS "Game Cost"
FROM GAME G
INNER JOIN PRICE P 
ON G.PRICE_CODE = P.PRICE_CODE;

--18
SELECT G.GENRE, TO_CHAR(AVG(P.RENT_FEE), 'L999G999D99') AS "Avg. Fee"
FROM GAME G
INNER JOIN PRICE P 
ON G.PRICE_CODE = P.PRICE_CODE
GROUP BY G.GENRE
ORDER BY G.GENRE ASC;

--19
SELECT GENRE, TITLE, COST
FROM GAME G
WHERE COST > (SELECT AVG(COST) FROM GAME WHERE GENRE = G.GENRE);

--20
UPDATE GAME G
SET COST = COST - 2.50
WHERE COST > (SELECT AVG(COST) FROM GAME WHERE GENRE = G.GENRE);

SELECT GENRE, TITLE, COST
FROM GAME G
WHERE COST > (SELECT AVG(COST) FROM GAME WHERE GENRE = G.GENRE);    

COMMIT;

--21
SELECT G.TITLE, G.YEAR, ROUND(G.COST / P.RENT_FEE, 2) AS "BER#"
FROM GAME G
INNER JOIN PRICE P 
ON G.PRICE_CODE = P.PRICE_CODE;

--22
SELECT M.MEM_NUM AS "Member #", M.LNAME || ', ' || M.FNAME AS "Member Name", TO_CHAR(BALANCE, 'L999G999D99') AS "BALANCE"
FROM MEMBERSHIP M
WHERE 
    EXISTS (
        SELECT 1 
        FROM RENTAL R 
        WHERE M.MEM_NUM = R.MEM_NUM
    )
ORDER BY M.LNAME ASC;

--23
SELECT R.RENT_NUM AS "Renta", TO_CHAR(R.RENT_DATE, 'DD-MON-YY') AS "Rented On", G.TITLE AS "Game Title", TO_CHAR(P.RENT_FEE, 'L999G999D99') 
AS "Rental Fee"
FROM RENTAL R
INNER JOIN DETAILRENTAL D 
ON R.RENT_NUM = D.RENT_NUM
INNER JOIN GAMECOPY GC 
ON GC.GC_NUM = D.GC_NUM
INNER JOIN GAME G 
ON G.GA_NUM = GC.GA_NUM
INNER JOIN PRICE P 
ON G.PRICE_CODE = P.PRICE_CODE
WHERE D.RETURN_DATE <= D.DUE_DATE
ORDER BY R.RENT_NUM ASC;

--24
SELECT R.RENT_NUM AS "Rental #",D.GC_NUM AS "Copy Number", G.TITLE AS "Game Title", TO_CHAR(R.RENT_DATE, 'YYYY-MM-DD')  AS "Rented On", 
TO_CHAR(D.DUE_DATE, 'YYYY-MM-DD') AS "Due Back By", TO_CHAR(D.RETURN_DATE, 'YYYY-MM-DD') AS "Return On"
FROM RENTAL R
INNER JOIN DETAILRENTAL D 
ON R.RENT_NUM = D.RENT_NUM
INNER JOIN GAMECOPY GC 
ON GC.GC_NUM = D.GC_NUM
INNER JOIN GAME G 
ON G.GA_NUM = GC.GA_NUM
WHERE D.RETURN_DATE > D.DUE_DATE
ORDER BY R.RENT_NUM ASC, G.TITLE ASC;

--25
SELECT R.RENT_NUM AS "Rental #",D.GC_NUM AS "Copy Number", G.TITLE AS "Game Title", TO_CHAR(R.RENT_DATE, 'YYYY-MM-DD')  AS "Rented On", 
TO_CHAR(D.DUE_DATE, 'YYYY-MM-DD') AS "Due Back By", TO_CHAR(D.RETURN_DATE, 'YYYY-MM-DD') AS "Return On", (D.RETURN_DATE - D.DUE_DATE) AS "Days Late"
FROM RENTAL R
INNER JOIN DETAILRENTAL D 
ON R.RENT_NUM = D.RENT_NUM
INNER JOIN GAMECOPY GC 
ON GC.GC_NUM = D.GC_NUM
INNER JOIN GAME G 
ON G.GA_NUM = GC.GA_NUM
WHERE D.RETURN_DATE > D.DUE_DATE
ORDER BY R.RENT_NUM ASC, G.TITLE ASC;

--26
SELECT R.RENT_NUM AS "Rental #",D.GC_NUM AS "Copy Number", G.TITLE AS "Game Title", TO_CHAR(R.RENT_DATE, 'YY-MM-DD')  AS "Rented On", 
TO_CHAR(D.DUE_DATE, 'YY-MM-DD') AS "Due Back By", TO_CHAR(D.RETURN_DATE, 'YY-MM-DD') AS "Return On", 
(D.RETURN_DATE - D.DUE_DATE) AS "Days Late",  TO_CHAR((D.RETURN_DATE - D.DUE_DATE) * D.DAILY_LATE_FEE, 'L999G999D99') AS "Late Fees Paid"
FROM RENTAL R
INNER JOIN DETAILRENTAL D 
ON R.RENT_NUM = D.RENT_NUM
INNER JOIN GAMECOPY GC 
ON GC.GC_NUM = D.GC_NUM
INNER JOIN GAME G 
ON G.GA_NUM = GC.GA_NUM
WHERE D.RETURN_DATE > D.DUE_DATE
ORDER BY R.RENT_NUM ASC, G.TITLE ASC;

--27
SELECT R.RENT_NUM AS "Rental #",GC.GC_NUM AS "Copy Number", G.TITLE AS "Game Title", TO_CHAR(R.RENT_DATE, 'YY-MM-DD')  AS "Rented On", 
TO_CHAR(D.DUE_DATE, 'YY-MM-DD') AS "Due Back By", CURRENT_DATE - D.DUE_DATE AS "Days Late",
TO_CHAR((CURRENT_DATE - D.DUE_DATE) * D.DAILY_LATE_FEE, 'L999G999D99') AS "Late Fees Paid"
FROM RENTAL R
INNER JOIN DETAILRENTAL D 
ON R.RENT_NUM = D.RENT_NUM
INNER JOIN GAMECOPY GC 
ON GC.GC_NUM = D.GC_NUM
INNER JOIN GAME G 
ON G.GA_NUM = GC.GA_NUM
INNER JOIN PRICE P
ON P.PRICE_CODE = G.PRICE_CODE
WHERE D.RETURN_DATE IS NULL AND CURRENT_DATE > D.DUE_DATE
ORDER BY R.RENT_NUM, G.TITLE;

--28
SELECT M.MEM_NUM AS "Membership #", M.LNAME || ', ' || M.FNAME AS "Customer Name", COUNT(R.RENT_NUM) AS "# Games Rented", 
TO_CHAR(SUM(D.FEE), 'L999G999D99') AS "Rental Fee", TO_CHAR(SUM(
        CASE 
            WHEN D.RETURN_DATE > D.DUE_DATE 
            THEN (D.RETURN_DATE - D.DUE_DATE) * D.DAILY_LATE_FEE 
            ELSE 0 
        END
    ), 'L999G999D99') AS "Late Fee",
    TO_CHAR(SUM(D.FEE) + SUM(
        CASE 
            WHEN D.RETURN_DATE > D.DUE_DATE 
            THEN (D.RETURN_DATE - D.DUE_DATE) * D.DAILY_LATE_FEE 
            ELSE 0 
        END
    ), 'L999G999D99') AS "Total Fees"
FROM MEMBERSHIP M
INNER JOIN RENTAL R 
ON M.MEM_NUM = R.MEM_NUM
INNER JOIN DETAILRENTAL D 
ON R.RENT_NUM = D.RENT_NUM
INNER JOIN GAMECOPY GC 
ON GC.GC_NUM = D.GC_NUM
INNER JOIN GAME G 
ON G.GA_NUM = GC.GA_NUM
INNER JOIN PRICE P 
ON G.PRICE_CODE = P.PRICE_CODE
GROUP BY M.MEM_NUM, M.LNAME, M.FNAME
ORDER BY M.MEM_NUM;